// entries.js

const entries = [
        {
        id: 'job32',
        title: 'CRN - Conselho Regional de Nutricionistas - 11ª Região',
        enterprise: 'Concurso Público',
        location: 'Nordeste',
        description: '7 vagas, salário de R$ 3.973,53, Superior.',
        email: 'https://www.idib.org.br/Concurso.aspx?ID=286',
        startDate: '2024-04-08T08:00:00-03:00',
        endDate: '2024-05-06T00:20:00-03:00'
    },
    {
        id: 'job31',
        title: 'Repositor',
        enterprise: 'Mercadinho do Seu Zé',
        location: 'Petrolina-PE',
        description: 'Experiência anterior em pilotar aeronaves, de preferência BOEING, estágio de ensino ou tutoria em Física Nuclear, Conhecimento de métodos de ensino eficazes e técnicas de avaliação de Datação quantica.',
        phone: '+55870000000',
        startDate: '2024-04-08T08:00:00-03:00',
        endDate: '2024-04-09T00:20:00-03:00'
    },
    {
        id: 'job1',
        title: 'Professor',
        enterprise: 'Colégio Madre Tereza de Calcutá',
        location: 'Petrolina-PE',
        description: 'Experiência, Conhecimento de métodos de ensino eficazes e técnicas de avaliação.',
        phone: '+55870000000',
        startDate: '2024-04-08T08:00:00-03:00',
        endDate: '2024-04-09T00:20:00-03:00'
    },
    {
        id: 'job2',
        title: 'Gerente Comercial',
        enterprise: 'ZXC Magazine',
        location: 'Juazeiro-BA',
        description: 'Capacidade de motivar, Excelente capacidade de comunicação e habilidades interpessoais.',
        email: 'exemplo2@empresa.com',
        startDate: '2024-04-08T08:00:00-03:00',
        endDate: '2024-04-20T00:20:00-03:00'
    },
    {
        id: 'job3',
        title: 'Analista de RH',
        enterprise: 'Construc Engenharia',
        location: 'Lagoa Grande-PE',
        description: 'Experiência em lidar com avaliação de desempenho, gestão de conflitos e resolução de problemas.',
        email: 'exemplo3@empresa.com',
        startDate: '2024-04-08T08:00:00-03:00',
        endDate: '2024-04-20T00:20:00-03:00'
    },
    {
        id: 'job4',
        title: 'Arquiteto',
        enterprise: 'Urban Arquitetura e Projetos',
        location: 'Petrolina-PE',
        description: 'Compreensão sólida dos princípios de engenharia estrutural, sistemas mecânicos, elétricos e hidráulicos.',
        phone: '+558711111111',
        startDate: '2024-04-08T08:00:00-03:00',
        endDate: '2024-04-19T00:20:00-03:00'
    },
    {
        id: 'job5',
        title: 'Engenheiro de Software',
        enterprise: 'TechSolutions Ltda.',
        location: 'Petrolina-PE',
        description: 'JavaScript, Python, Desenvolvimento Web.',
        email: 'exemplo8@empresa.com',
        startDate: '2024-04-07T09:00:00-03:00',
        endDate: '2024-04-10T00:20:00-03:00'
    },
    {
        id: 'job6',
        title: 'Designer Gráfico',
        enterprise: 'VisualArts Inc.',
        location: 'Petrolina-PE',
        description: 'Adobe Photoshop, Ilustração, Design de Interface.',
        phone: '+55871111111',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-12T00:20:00-03:00'
    },
    {
        id: 'job7',
        title: 'Enfermeiro',
        enterprise: 'CareHealth S.A.',
        location: 'Petrolina-PE',
        description: 'Assistência ao Paciente, Administração de Medicamentos, Emergências Médicas.',
        email: 'exemplo35@empresa.com',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-11T00:20:00-03:00'
    },
    {
        id: 'job8',
        title: 'Engenheiro Civil',
        enterprise: 'BuildCorp Construções',
        location: 'Petrolina-PE',
        description: 'Cálculos Estruturais, Gerenciamento de Projetos, Autocad.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-20T00:20:00-03:00'
    },
    {
        id: 'job9',
        title: 'Contador',
        enterprise: 'FinanceExperts Consultoria',
        location: 'Petrolina-PE',
        description: 'Análise Financeira, Declaração de Impostos, Contabilidade Gerencial.',
        email: 'exemplo38@empresa.com',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-03T00:20:00-03:00',
    },
    {
        id: 'job10',
        title: 'Advogado',
        enterprise: 'LegalAlliance Advocacia',
        location: 'Petrolina-PE',
        description: 'Direito Civil, Contencioso, Negociação.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-20T00:20:00-03:00'
    },
    {
        id: 'job11',
        title: 'Analista de Marketing',
        enterprise: 'BrandBoost Marketing Digital',
        location: 'Petrolina-PE',
        description: 'SEO, Marketing de Conteúdo, Análise de Dados.',
        email: 'exemplo011@empresa.com',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-20T00:20:00-03:00'
    },
    {
        id: 'job12',
        title: 'Desenvolvedor de Jogos',
        enterprise: 'GameMaster Studios',
        location: 'Petrolina-PE',
        description: 'Unity, Game Design, C#.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-03T00:20:00-03:00',
    },
    {
        id: 'job13',
        title: 'Psicólogo',
        enterprise: 'MindWell Clínica de Psicologia',
        location: 'Petrolina-PE',
        description: 'Aconselhamento, Psicoterapia, Avaliação Psicológica.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-20T00:20:00-03:00'
    },
    {
        id: 'job14',
        title: 'Engenheiro Eletricista',
        enterprise: 'EnerPower Soluções Elétricas',
        location: 'Curitiba-PR',
        description: 'Instalação Elétrica, Manutenção de Sistemas, Análise de Circuitos.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-20T00:20:00-03:00'
    },
    {
        id: 'job15',
        title: 'Farmacêutico',
        enterprise: 'PharmaCare Farmácia',
        location: 'Belo Horizonte-MG',
        description: 'Dispensação de Medicamentos, Controle de Qualidade, Farmacologia.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-20T00:20:00-03:00'
    },
    {
        id: 'job16',
        title: 'Consultor Financeiro',
        enterprise: 'FinExpert Consultoria Financeira',
        location: 'Rio de Janeiro-RJ',
        description: 'Planejamento Financeiro, Análise de Investimentos, Contabilidade.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job17',
        title: 'Desenvolvedor Frontend',
        enterprise: 'WebTech Solutions',
        location: 'São Paulo-SP',
        description: 'HTML, CSS, JavaScript, Frameworks Frontend.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job18',
        title: 'Nutricionista',
        enterprise: 'HealthyLife Clínica Nutricional',
        location: 'Porto Alegre-RS',
        description: 'Avaliação Nutricional, Elaboração de Dietas, Educação Alimentar.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job19',
        title: 'Técnico em Informática',
        enterprise: 'InfoSupport Assistência Técnica',
        location: 'Salvador-BA',
        description: 'Manutenção de Computadores, Suporte Técnico, Redes.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job20',
        title: 'Engenheiro de Produção',
        enterprise: 'ProdPlan Indústria',
        location: 'Campinas-SP',
        description: 'Gestão da Produção, Otimização de Processos, Controle de Qualidade.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job21',
        title: 'Arquiteto',
        enterprise: 'UrbanDesign Arquitetura',
        location: 'Brasília-DF',
        description: 'Design Arquitetônico, Modelagem 3D, Planejamento Urbano.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job22',
        title: 'Assistente Social',
        enterprise: 'SocialCare ONG',
        location: 'Recife-PE',
        description: 'Acolhimento Social, Encaminhamento de Assistidos, Trabalho Comunitário.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job23',
        title: 'Professor de Inglês',
        enterprise: 'GlobalEnglish Escola de Idiomas',
        location: 'Fortaleza-CE',
        description: 'Ensino de Inglês, Preparação para Certificações, Comunicação Oral.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job24',
        title: 'Engenheiro Químico',
        enterprise: 'ChemTech Indústria Química',
        location: 'Manaus-AM',
        description: 'Processos Químicos, Controle Ambiental, Pesquisa e Desenvolvimento.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job25',
        title: 'Analista de Sistemas',
        enterprise: 'TechInnovate Software',
        location: 'Goiânia-GO',
        description: 'Análise de Requisitos, Desenvolvimento de Software, Testes.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job26',
        title: 'Biomédico',
        enterprise: 'BioLab Laboratório de Análises',
        location: 'Florianópolis-SC',
        description: 'Análises Clínicas, Pesquisa Biomédica, Diagnóstico por Imagem.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job27',
        title: 'Engenheiro Mecânico',
        enterprise: 'MecPower Indústria Metalúrgica',
        location: 'Porto Velho-RO',
        description: 'Projeto de Máquinas, Automação Industrial, Manutenção Mecânica.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job28',
        title: 'Médico Veterinário',
        enterprise: 'AnimalCare Clínica Veterinária',
        location: 'Cuiabá-MT',
        description: 'Clínica de Pequenos e Grandes Animais, Cirurgia Veterinária, Zootecnia.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job29',
        title: 'Analista de Recursos Humanos',
        enterprise: 'PeopleFirst Consultoria RH',
        location: 'Natal-RN',
        description: 'Recrutamento e Seleção, Avaliação de Desempenho, Treinamento e Desenvolvimento.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    },
    {
        id: 'job30',
        title: 'Designer de Interiores',
        enterprise: 'InteriorDesign Studio',
        location: 'São Luís-MA',
        description: 'Projeto de Ambientes, Decoração de Interiores, Design de Mobiliário.',
        phone: '+55870000000',
        startDate: '2024-04-02T23:05:00-03:00',
        endDate: '2024-04-05T00:20:00-03:00'
    }       
];

const jobCache = {};

function disableInput(input) {
    if (input) {
        input.disabled = true;
        input.style.userSelect = 'none';
        input.style.pointerEvents = 'none';
    }
}

function preventCopy(input) {
    if (input) {
        input.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'c') {
                event.preventDefault();
            }
        });
    }
}

function updateTimer(jobId, startDate, endDate) {
    if (!jobCache[jobId]) {
        const job = document.getElementById(jobId);
        const timerDiv = job.querySelector('.timer');
        const expiredMessage = job.querySelector('.expired-message');
        const emailInput = job.querySelector('.email input');
        const phoneInput = job.querySelector('.phone input');

        jobCache[jobId] = {
            job,
            timerDiv,
            expiredMessage,
            emailInput,
            phoneInput,
            start: new Date(startDate),
            end: new Date(endDate),
            interval: null
        };

        preventCopy(emailInput);
        preventCopy(phoneInput);
    }

    const { job, timerDiv, expiredMessage, emailInput, phoneInput, start, end, interval } = jobCache[jobId];
    const now = new Date();
    const remainingTime = end - now;

    if (remainingTime <= 0) {
        clearInterval(interval);
        job.classList.add('expired');
        expiredMessage.style.display = 'block';
        timerDiv.style.display = 'none';

        disableInput(emailInput);
        disableInput(phoneInput);

        const phoneDiv = job.querySelector('.phone');
        if (phoneDiv) {
            phoneDiv.style.display = 'none';
        }

        const inputs = [emailInput, phoneInput];
        inputs.forEach(input => {
            if (input) {
                input.style.filter = 'blur(5px)';
                const tooltips = job.querySelectorAll('.tooltip');
                tooltips.forEach(tooltip => tooltip.style.pointerEvents = 'none');
            }
        });
    } else {
        const days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
        const hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);

        timerDiv.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;

        const timeSinceStart = now - start;
        if (timeSinceStart <= 12 * 60 * 60 * 1000) {
            job.classList.add('new');
        } else {
            job.classList.remove('new');
        }
    }

    if (!interval) {
        jobCache[jobId].interval = setInterval(() => updateTimer(jobId, startDate, endDate), 1000);
    }
}

const jobListingsContainer = document.querySelector('.job-listings');

function generateJobListingsWithPhoneAndEmail(entries) {
    entries.forEach(entry => {
        const jobListing = document.createElement('div');
        jobListing.classList.add('job');
        jobListing.id = entry.id;

        jobListing.innerHTML = `
        <h3 style="margin-bottom: 0.5em;">${entry.title}</h3>
        <h5 style="margin-bottom: 0.5em;">${entry.enterprise}</h5>
        <p style="margin-bottom: 0.5em;">${entry.location}</p>
        <p style="margin-bottom: 0.5em;">${entry.description}</p>
            <a href="javascript:void(0)" class="button"><span>Candidatar-se</span></a>
            ${entry.phone ? `<div class="phone" style="display: none;"><input type="text" id="phoneInput" value="${entry.phone}" readonly></div>` : ''}
            ${entry.email ? `<div class="email" style="display: none;"><input type="text" id="emailInput" value="${entry.email}" readonly></div>` : ''}
            <div class="tooltip" style="display: none;">Email copiado!</div>
            <div class="timer" data-data-inicio="${entry.startDate}" data-data-fim="${entry.endDate}"></div>
            <div class="expired-message" style="display: none;">Anúncio Expirado</div>
        `;

        jobListing.querySelector('.button').addEventListener('click', () => {
            if (entry.phone) {
                exibirWhatsApp(entry.id);
            } else if (entry.email) {
                exibirEmail(entry.id);
            }
        });

        const phoneInput = jobListing.querySelector('#phoneInput');
        if (phoneInput) {
            phoneInput.addEventListener('click', () => openWhatsApp(phoneInput.value));
        }

        const emailInput = jobListing.querySelector('.email input');
        if (emailInput) {
            emailInput.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(emailInput.value);
                    const tooltip = jobListing.querySelector('.tooltip');
                    tooltip.style.display = 'block';
                    setTimeout(() => tooltip.style.display = 'none', 3000);
                } catch (err) {
                    console.error('Falha ao copiar o texto: ', err);
                }
            });
        }

        jobListing.timerInterval = setInterval(() => updateTimer(entry.id, entry.startDate, entry.endDate), 1000);

        jobListingsContainer.appendChild(jobListing);
    });
}

function exibirEmail(jobId) {
    const job = document.getElementById(jobId);
    const emailDiv = job.querySelector('.email');
    emailDiv.style.display = emailDiv.style.display === "block" ? "none" : "block";
}

function exibirWhatsApp(jobId) {
    const job = document.getElementById(jobId);
    const phoneDiv = job.querySelector('.phone');
    phoneDiv.style.display = phoneDiv.style.display === 'none' ? 'block' : 'none';
}

function openWhatsApp(phoneNumber) {
    window.open('https://wa.me/' + phoneNumber, '_blank');
}

document.addEventListener('DOMContentLoaded', () => {
    generateJobListingsWithPhoneAndEmail(entries);
});
